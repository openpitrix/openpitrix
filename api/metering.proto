// Copyright 2018 The OpenPitrix Authors. All rights reserved.
// Use of this source code is governed by a Apache license
// that can be found in the LICENSE file.

syntax = "proto3";

package openpitrix;

// set go package name to pb
option go_package = "pb";

import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";
import "protoc-gen-swagger/options/annotations.proto";

enum AttributeType {
	NORMAL = 0;
	METERING = 1;
}

//************************************* Sku *************************
//the values of status are: active/deleted
//attribute_name
message AttributeName {
	google.protobuf.StringValue attribute_name_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue description = 3;
	AttributeType type = 4;
	google.protobuf.StringValue status = 5;
	google.protobuf.Timestamp create_time = 6;
	google.protobuf.Timestamp status_time = 7;
}

message CreateAttributeNameRequest {
	google.protobuf.StringValue name = 1;
	google.protobuf.StringValue description = 2;
	AttributeType type = 3;
}

message CreateAttributeNameResponse {
	google.protobuf.StringValue attribute_name_id = 1;
}

message DescribeAttributeNamesRequest {
	google.protobuf.StringValue attribute_name_id = 1;
	google.protobuf.StringValue name = 2;
	AttributeType type = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeAttributeNamesResponse {
	repeated AttributeName attribute_names = 1;
}

message ModifyAttributeNameRequest {
	google.protobuf.StringValue attribute_name_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue description = 3;
	AttributeType type = 4;
}

message ModifyAttributeNameResponse {
	google.protobuf.StringValue attribute_name_id = 1;
}

message DeleteAttributeNamesRequest {
	repeated string attribute_name_ids = 1;
}

message DeleteAttributeNamesResponse {
	repeated string attribute_name_ids = 1;
}

//attribute_unit
message AttributeUnit {
	google.protobuf.StringValue attribute_unit_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue status = 3;
	google.protobuf.Timestamp create_time = 4;
	google.protobuf.Timestamp status_time = 5;
}

message CreateAttributeUnitRequest {
	google.protobuf.StringValue name = 1;
}

message CreateAttributeUnitResponse {
	google.protobuf.StringValue attribute_unit_id = 1;
}

message DescribeAttributeUnitsRequest {
	google.protobuf.StringValue attribute_unit_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue status = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeAttributeUnitsResponse {
	repeated AttributeUnit attribute_units = 1;
}

message ModifyAttributeUnitRequest {
	google.protobuf.StringValue attribute_unit_id = 1;
	google.protobuf.StringValue name = 2;
}

message ModifyAttributeUnitResponse {
	google.protobuf.StringValue attribute_unit_id = 1;
}

message DeleteAttributeUnitsRequest {
	repeated string attribute_unit_ids = 1;
}

message DeleteAttributeUnitsResponse {
	repeated string attribute_unit_ids = 1;
}

//attribute
message Attribute {
	google.protobuf.StringValue attribute_id = 1;
	google.protobuf.StringValue attribute_name_id = 2;
	google.protobuf.StringValue attribute_unit_id = 3;
	//the types of value: single int value, scope of value (min_value, max_value], string value
	google.protobuf.StringValue value = 4;
	google.protobuf.StringValue owner = 5; //the user_id created attribute
	google.protobuf.StringValue status = 6;
	google.protobuf.Timestamp create_time = 7;
	google.protobuf.Timestamp status_time = 8;
}

message CreateAttributeRequest {
	google.protobuf.StringValue attribute_name_id = 1;
	google.protobuf.StringValue attribute_unit_id = 2;
	google.protobuf.StringValue value = 3;
}

message CreateAttributeResponse {
	google.protobuf.StringValue attribute_id = 1;
}

message DescribeAttributesRequest {
	google.protobuf.StringValue attribute_id = 1;
	google.protobuf.StringValue attribute_name_id = 2;
	google.protobuf.StringValue attribute_unit_id = 3;
	google.protobuf.StringValue owner = 4;
	google.protobuf.StringValue status = 5;
	google.protobuf.StringValue sort_key = 6;
	google.protobuf.BoolValue reverse = 7;
	uint32 offset = 8;
	uint32 limit = 9;
}

message DescribeAttributesResponse {
	repeated Attribute attributes = 1;
}

message ModifyAttributeRequest {
	google.protobuf.StringValue attribute_id = 1;
	google.protobuf.StringValue attribute_name_id = 2;
	google.protobuf.StringValue attribute_unit_id = 3;
	google.protobuf.StringValue value = 4;
}

message ModifyAttributeResponse {
	google.protobuf.StringValue attribute_id = 1;
}

message DeleteAttributesRequest {
	repeated string attribute_ids = 1;
}

message DeleteAttributesResponse {
	repeated string attribute_ids = 1;
}

//spu: standard product unit
message Spu {
	google.protobuf.StringValue spu_id = 1;
	google.protobuf.StringValue product_id = 2;  //product_id: the  app_id / app_version_id / other_ids..
	google.protobuf.StringValue owner = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp create_time = 5;
	google.protobuf.Timestamp status_time = 6;
}

message CreateSpuRequest {
	google.protobuf.StringValue product_id = 1;
}

message CreateSpuResponse {
	google.protobuf.StringValue spu_id = 1;
}

message DescribeSpusRequest {
	google.protobuf.StringValue spu_id = 1;
	google.protobuf.StringValue product_id = 2;
	google.protobuf.StringValue owner = 3; //created user_id
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeSpusResponse {
	repeated Spu spus = 1;
}

message ModifySpuRequest {
	google.protobuf.StringValue spu_id = 1;
	google.protobuf.StringValue product_id = 2;
}

message ModifySpuResponse {
	google.protobuf.StringValue spu_id = 1;
}

message DeleteSpusRequest {
	repeated string spu_ids = 1;
}

message DeleteSpusResponse {
	repeated string spu_ids = 1;
}

//Sku: stock keeping unit
message Sku {
	google.protobuf.StringValue sku_id = 1;
	google.protobuf.StringValue spu_id = 2;
	repeated string attribute_ids = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp create_time = 5;
	google.protobuf.Timestamp status_time = 6;
}

message CreateSkuRequest {
	google.protobuf.StringValue spu_id = 1;
	repeated string attribute_ids = 2;
}

message CreateSkuResponse {
	google.protobuf.StringValue sku_id = 1;
}

message DescribeSkusRequest {
	google.protobuf.StringValue sku_id = 1;
	google.protobuf.StringValue spu_id = 2;
	google.protobuf.StringValue status = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeSkusResponse {
	repeated Sku skus = 1;
}

message ModifySkuRequest {
	google.protobuf.StringValue sku_id = 1;
	google.protobuf.StringValue spu_id = 2;
	repeated string attribute_ids = 3;
}

message ModifySkuResponse {
	google.protobuf.StringValue sku_id = 1;
}

message DeleteSkusRequest {
	repeated string sku_ids = 1;
}

message DeleteSkusResponse {
	repeated string sku_ids = 1;
}

//metering_attribute_binding
message MeteringAttributeBinding { // binding metering_attribute_id into sku_id
	google.protobuf.StringValue binding_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue attribute_id = 3; //the attribute id that need to metering
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp create_time = 5;
	google.protobuf.Timestamp status_time = 6;
}

message CreateMeteringAttributeBindingsRequest {
	google.protobuf.StringValue sku_id = 1;
	repeated string attribute_ids = 2;
}

message CreateMeteringAttributeBindingsResponse {
	repeated string binding_ids = 1;
}

message DescribeMeteringAttributeBindingsRequest {
	google.protobuf.StringValue binding_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue status = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeMeteringAttributeBindingsResponse {
	repeated MeteringAttributeBinding meteringAttributeBindings = 1;
}

message ModifyMeteringAttributeBindingRequest {
	google.protobuf.StringValue binding_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
}

message ModifyMeteringAttributeBindingResponse {
	google.protobuf.StringValue binding_id = 1;
}

message DeleteMeteringAttributeBindingsRequest {
	repeated string binding_ids = 1;
}

message DeleteMeteringAttributeBindingsResponse {
	repeated string binding_ids = 1;
}

service SkuManager {
	rpc CreateAttributeName (CreateAttributeNameRequest) returns (CreateAttributeNameResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "create attribute name"
		};
		option (google.api.http) = {
			post: "/v1/metering/attribute/name"
			body: "*"
		};
	}

	rpc DescribeAttributeNames (DescribeAttributeNamesRequest) returns (DescribeAttributeNamesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe attribute_names"
		};
		option (google.api.http) = {
			get: "/v1/metering/attribute/names"
		};
	}

	rpc ModifyAttributeName (ModifyAttributeNameRequest) returns (ModifyAttributeNameResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify attribute_name"
		};
		option (google.api.http) = {
			put: "/v1/metering/attribute/name"
			body: "*"
		};
	}

	rpc DeleteAttributeNames (DeleteAttributeNamesRequest) returns (DeleteAttributeNamesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete attribute_names"
		};
		option (google.api.http) = {
			delete: "/v1/metering/attribute/names"
			body: "*"
		};
	}

	rpc CreateAttributeUnit (CreateAttributeUnitRequest) returns (CreateAttributeUnitResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create attribute unit"
        };
		option (google.api.http) = {
            post: "/v1/metering/attribute/unit"
            body: "*"
        };
	}

	rpc DescribeAttributeUnits (DescribeAttributeUnitsRequest) returns (DescribeAttributeUnitsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe attribute_units"
		};
		option (google.api.http) = {
			get: "/v1/metering/attribute/units"
		};
	}

	rpc ModifyAttributeUnit (ModifyAttributeUnitRequest) returns (ModifyAttributeUnitResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify attribute_unit"
		};
		option (google.api.http) = {
			put: "/v1/metering/attribute/unit"
			body: "*"
		};
	}

	rpc DeleteAttributeUnits (DeleteAttributeUnitsRequest) returns (DeleteAttributeUnitsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete attribute_units"
		};
		option (google.api.http) = {
			delete: "/v1/metering/attribute/units"
			body: "*"
		};
	}

	rpc CreateAttribute (CreateAttributeRequest) returns (CreateAttributeResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create attribute"
        };
		option (google.api.http) = {
            post: "/v1/metering/attribute"
            body: "*"
        };
	}

	rpc DescribeAttributes (DescribeAttributesRequest) returns (DescribeAttributesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe attributes"
		};
		option (google.api.http) = {
			get: "/v1/metering/attributes"
		};
	}

	rpc ModifyAttribute (ModifyAttributeRequest) returns (ModifyAttributeResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify attribute"
		};
		option (google.api.http) = {
			put: "/v1/metering/attribute"
			body: "*"
		};
	}

	rpc DeleteAttributes (DeleteAttributesRequest) returns (DeleteAttributesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete attributes"
		};
		option (google.api.http) = {
			delete: "/v1/metering/attributes"
			body: "*"
		};
	}

	rpc CreateSpu (CreateSpuRequest) returns (CreateSpuResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create spu"
        };
		option (google.api.http) = {
            post: "/v1/metering/spu"
            body: "*"
        };
	}

	rpc DescribeSpus (DescribeSpusRequest) returns (DescribeSpusResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe spus"
		};
		option (google.api.http) = {
			get: "/v1/metering/spus"
		};
	}

	rpc ModifySpu (ModifySpuRequest) returns (ModifySpuResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify spu"
		};
		option (google.api.http) = {
			put: "/v1/metering/spu"
			body: "*"
		};
	}

	rpc DeleteSpus (DeleteSpusRequest) returns (DeleteSpusResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete spus"
		};
		option (google.api.http) = {
			delete: "/v1/metering/spus"
			body: "*"
		};
	}

	rpc CreateSku (CreateSkuRequest) returns (CreateSkuResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create sku of the product"
        };
		option (google.api.http) = {
            post: "/v1/metering/sku"
            body: "*"
        };
	}

	rpc DescribeSkus (DescribeSkusRequest) returns (DescribeSkusResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe skus"
		};
		option (google.api.http) = {
			get: "/v1/metering/skus"
		};
	}

	rpc ModifySku (ModifySkuRequest) returns (ModifySkuResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify sku"
		};
		option (google.api.http) = {
			put: "/v1/metering/sku"
			body: "*"
		};
	}

	rpc DeleteSkus (DeleteSkusRequest) returns (DeleteSkusResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete skus"
		};
		option (google.api.http) = {
			delete: "/v1/metering/skus"
			body: "*"
		};
	}

	rpc CreateMeteringAttributeBindings (CreateMeteringAttributeBindingsRequest) returns (CreateMeteringAttributeBindingsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create metering attribute bindings of sku"
        };
		option (google.api.http) = {
            post: "/v1/metering/attribute/bingings"
            body: "*"
        };
	}

	rpc DescribeMeteringAttributeBindings (DescribeMeteringAttributeBindingsRequest) returns (DescribeMeteringAttributeBindingsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe metering attribute bindings of sku"
		};
		option (google.api.http) = {
			get: "/v1/metering/attribute/bindings"
		};
	}

	rpc ModifyMeteringAttributeBinding (ModifyMeteringAttributeBindingRequest) returns (ModifyMeteringAttributeBindingResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify metering attribute binding of sku"
		};
		option (google.api.http) = {
			put: "/v1/metering/attribute/binding"
			body: "*"
		};
	}

	rpc DeleteMeteringAttributeBindings (DeleteMeteringAttributeBindingsRequest) returns (DeleteMeteringAttributeBindingsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete metering attribute bindings of sku"
		};
		option (google.api.http) = {
			delete: "/v1/metering/attribute/bindings"
			body: "*"
		};
	}
}


//************************************* Promotion *************************
//combination
message Combination {
    google.protobuf.StringValue combination_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue description = 3;
	google.protobuf.StringValue owner = 4;
	google.protobuf.StringValue status = 5;
	google.protobuf.Timestamp start_time = 6; //start time for this combination, default now
	google.protobuf.Timestamp end_time = 7; //overdue time for this combination, default null(forever)
	google.protobuf.Timestamp create_time = 8;
	google.protobuf.Timestamp status_time = 9;
}

message CreateCombinationRequest {
	google.protobuf.StringValue name = 1;
	google.protobuf.StringValue description = 2;
	google.protobuf.Timestamp start_time = 3;
	google.protobuf.Timestamp end_time = 4;
}

message CreateCombinationResponse {
	google.protobuf.StringValue combination_id = 1;
}

message DescribeCombinationsRequest {
	google.protobuf.StringValue combination_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue owner = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeCombinationsResponse {
	repeated Combination combinations = 1;
}

message ModifyCombinationRequest {
	google.protobuf.StringValue combination_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue description = 3;
	google.protobuf.Timestamp start_time = 4;
	google.protobuf.Timestamp end_time = 5;
}

message ModifyCombinationResponse {
	google.protobuf.StringValue combination_id = 1;
}

message DeleteCombinationsRequest {
	repeated string combination_ids = 1;
}

message DeleteCombinationsResponse {
	repeated string combination_ids = 1;
}

//combination_sku
message CombinationSku {
    google.protobuf.StringValue combination_sku_id = 1;
    google.protobuf.StringValue combination_id = 2;
	google.protobuf.StringValue sku_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp create_time = 5;
	google.protobuf.Timestamp status_time = 6;
}

message CreateCombinationSkuRequest {
	google.protobuf.StringValue combination_id = 1;
	google.protobuf.StringValue sku_id = 2;
}

message CreateCombinationSkuResponse {
	google.protobuf.StringValue combination_sku_id = 1;
}

message DescribeCombinationSkusRequest {
	google.protobuf.StringValue combination_sku_id = 1;
	google.protobuf.StringValue combination_id = 2;
	google.protobuf.StringValue sku_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeCombinationSkusResponse {
	repeated CombinationSku combination_skus = 1;
}

message ModifyCombinationSkuRequest {
	google.protobuf.StringValue combination_sku_id = 1;
	google.protobuf.StringValue combination_id = 2;
	google.protobuf.StringValue sku_id = 3;
}

message ModifyCombinationSkuResponse {
	google.protobuf.StringValue combination_sku_id = 1;
}

message DeleteCombinationSkusRequest {
	repeated string combination_sku_ids = 1;
}

message DeleteCombinationSkusResponse {
	repeated string combination_sku_ids = 1;
}

//CombinationMABinding: CombinationMeteringAttributeBinding
message CombinationMABinding {
	google.protobuf.StringValue combination_binding_id = 1;
	google.protobuf.StringValue combination_sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp create_time = 5;
	google.protobuf.Timestamp status_time = 6;
}

message CreateCombinationMABindingRequest {
	google.protobuf.StringValue combination_sku_id = 1;
	google.protobuf.StringValue attribute_id = 2;
}

message CreateCombinationMABindingResponse {
	google.protobuf.StringValue combination_binding_id = 1;
}

message DescribeCombinationMABindingsRequest {
	google.protobuf.StringValue combination_binding_id = 1;
	google.protobuf.StringValue combination_sku_id = 2;
	google.protobuf.StringValue status = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeCombinationMABindingsResponse {
	repeated CombinationMABinding combination_ma_bindings = 1;
}

message ModifyCombinationMABindingRequest {
	google.protobuf.StringValue combination_binding_id = 1;
	google.protobuf.StringValue combination_sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
}

message ModifyCombinationMABindingResponse {
	google.protobuf.StringValue combination_binding_id = 1;
}

message DeleteCombinationMABindingsRequest {
	repeated string combination_binding_ids = 1;
}

message DeleteCombinationMABindingsResponse {
	repeated string combination_binding_ids = 1;
}

service PromotionSkuManager {
	rpc CreateCombination (CreateCombinationRequest) returns (CreateCombinationResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create combination"
        };
		option (google.api.http) = {
            post: "/v1/metering/combination"
            body: "*"
        };
	}

	rpc DescribeCombinations (DescribeCombinationsRequest) returns (DescribeCombinationsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe combinations"
		};
		option (google.api.http) = {
			get: "/v1/metering/combinations"
		};
	}

	rpc ModifyCombination (ModifyCombinationRequest) returns (ModifyCombinationResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify combination"
		};
		option (google.api.http) = {
			put: "/v1/metering/combination"
			body: "*"
		};
	}

	rpc DeleteCombinations (DeleteCombinationsRequest) returns (DeleteCombinationsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete combinations"
		};
		option (google.api.http) = {
			delete: "/v1/metering/combinations"
			body: "*"
		};
	}

	rpc CreateCombinationSku (CreateCombinationSkuRequest) returns (CreateCombinationSkuResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create combination_sku"
        };
		option (google.api.http) = {
            post: "/v1/metering/combination/sku"
            body: "*"
        };
	}

	rpc DescribeCombinationSkus (DescribeCombinationSkusRequest) returns (DescribeCombinationSkusResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe combination_skus"
		};
		option (google.api.http) = {
			get: "/v1/metering/combination/skus"
		};
	}

	rpc ModifyCombinationSku (ModifyCombinationSkuRequest) returns (ModifyCombinationSkuResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify combination_sku"
		};
		option (google.api.http) = {
			put: "/v1/metering/combination/sku"
			body: "*"
		};
	}

	rpc DeleteCombinationSkus (DeleteCombinationSkusRequest) returns (DeleteCombinationSkusResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete combination_skus"
		};
		option (google.api.http) = {
			delete: "/v1/metering/combination/skus"
			body: "*"
		};
	}

	rpc CreateCombinationMABinding (CreateCombinationMABindingRequest) returns (CreateCombinationMABindingResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create combination_ma_binding"
        };
		option (google.api.http) = {
            post: "/v1/metering/combination/mabinding"
            body: "*"
        };
	}

	rpc DescribeCombinationMABindings (DescribeCombinationMABindingsRequest) returns (DescribeCombinationMABindingsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe combination_ma_bindings"
		};
		option (google.api.http) = {
			get: "/v1/metering/combination/mabindings"
		};
	}

	rpc ModifyCombinationMABinding (ModifyCombinationMABindingRequest) returns (ModifyCombinationMABindingResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify combination_ma_binding"
		};
		option (google.api.http) = {
			put: "/v1/metering/combination/mabinding"
			body: "*"
		};
	}

	rpc DeleteCombinationMABindings (DeleteCombinationMABindingsRequest) returns (DeleteCombinationMABindingsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete combination_ma_bindings"
		};
		option (google.api.http) = {
			delete: "/v1/metering/combination/mabindings"
			body: "*"
		};
	}
}


//************************** metering ****************************

message MeteringValue {
	google.protobuf.StringValue attribute_id = 1;
	google.protobuf.DoubleValue value = 2;
}

message UpdateMeteringValue {
	MeteringValue metering_value = 1;
	enum UpdateValueTypes {
		INCREMENTAL = 0;
		REPLACE = 1;
	}
	UpdateValueTypes type = 2;
}

message UpdateSkuMetering {
	google.protobuf.StringValue sku_id = 1; //distinct sku/cobination by prefix
	//if the metering attributes of sku is only duration, this is nil
	repeated UpdateMeteringValue metering_values = 2;
}

//if sku_ids = [], mean is all skus of the reource
message Resource {
	google.protobuf.StringValue resource_id = 1;
	repeated string sku_ids = 2;
}

message InitMeteringRequest {
	google.protobuf.StringValue user_id = 1;
	google.protobuf.StringValue resource_id = 2;
	map<string, MeteringValue> sku_meterings = 3; //<skuId, MeteringValue>
}

message StartMeteringsRequest {
	repeated Resource resources = 1;
}

message UpdateMeteringRequest {
	google.protobuf.StringValue resource_id = 1;
	repeated UpdateSkuMetering sku_meterings = 2;
}

message StopMeteringsRequest {
	repeated Resource resources = 1;
}

message TerminateMeteringsRequest {
	repeated Resource resources = 1;
}

message CommonMeteringResponse {
	google.protobuf.StringValue resource_id = 1;
}

message CommonMeteringsResponse {
	repeated string resource_ids = 1;
}

message Leasing {
	google.protobuf.StringValue LeasingId = 1;
	google.protobuf.StringValue GroupId = 2;
	google.protobuf.StringValue UserId = 3;
	google.protobuf.StringValue ResourceId = 4;
	google.protobuf.StringValue SkuId = 5;
	map<string, double> MeteringValues = 6; //<attribute_id, value>
	google.protobuf.StringValue Status = 7;
	google.protobuf.Timestamp LeaseTime = 8;
	google.protobuf.Timestamp UpdateDurationTime = 9;
	google.protobuf.Timestamp RenewalTime = 10;
	google.protobuf.Timestamp CreateTime = 11;
	google.protobuf.Timestamp StatusTime = 12;
	map<string, string> StopTimes = 13; //<stop_time, start_time>
}

message DescribeLeasingsRequest {
	google.protobuf.StringValue LeasingId = 1;
	google.protobuf.StringValue GroupId = 2;
	google.protobuf.StringValue UserId = 3;
	google.protobuf.StringValue ResourceId = 4;
	google.protobuf.StringValue SkuId = 5;
	google.protobuf.StringValue Status = 6;
	google.protobuf.StringValue sort_key = 7;
	google.protobuf.BoolValue reverse = 8;
	uint32 offset = 9;
	uint32 limit = 10;
}

message DescribeLeasingsResponse {
	repeated Leasing leasings = 1;
}

service MeteringManager {
	rpc InitMetering (InitMeteringRequest) returns (CommonMeteringResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "init metering about the skus"
		};
		option (google.api.http) = {
			post: "/v1/metering/skus"
			body: "*"
		};
	}

	//start for stopped metering
	rpc StartMeterings (StartMeteringsRequest) returns (CommonMeteringsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "start metering about the skus"
		};
		option (google.api.http) = {
			put: "/v1/metering/start"
			body: "*"
		};
	}

	rpc UpdateMetering (UpdateMeteringRequest) returns (CommonMeteringResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "update metering value about the sku"
		};
		option (google.api.http) = {
			put: "/v1/metering/skus"
			body: "*"
		};
	}

	rpc StopMeterings (StopMeteringsRequest) returns (CommonMeteringsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "stop metering about the skus"
		};
		option (google.api.http) = {
			put: "/v1/metering/stop"
			body: "*"
		};
	}

	rpc TerminateMeterings (TerminateMeteringsRequest) returns (CommonMeteringsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "terminate metering about the skus"
        };
		option (google.api.http) = {
            delete: "/v1/metering/skus"
            body: "*"
        };
	}
}
