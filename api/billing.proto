// Copyright 2018 The OpenPitrix Authors. All rights reserved.
// Use of this source code is governed by a Apache license
// that can be found in the LICENSE file.

syntax = "proto3";

package openpitrix;

// set go package name to pb
option go_package = "pb";

import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";
import "protoc-gen-swagger/options/annotations.proto";


enum Currency {
	CNY = 0;
	HKD = 1;
	USD = 2;
}

//*************************************************************
//*********************** Billing *****************************
//*************************************************************
//price
message Price {
    google.protobuf.StringValue price_id = 1;
	google.protobuf.StringValue sku_id = 2; //sku id
	google.protobuf.StringValue attribute_id = 3; //metering_attribute id
	map<int64, double> prices = 4;  //{upto1: price1, upto2: price2, ...}, if upto is 0, the price is unchanged.
	Currency currency = 5;
	google.protobuf.StringValue status = 6;
	google.protobuf.Timestamp start_time = 7; //start time for this price, default now
	google.protobuf.Timestamp end_time = 8; //overdue time for this price, default null(forever)
	google.protobuf.Timestamp create_time = 9;
	google.protobuf.Timestamp status_time = 10;
}

message CreatePriceRequest {
	google.protobuf.StringValue sku_id = 1;
	google.protobuf.StringValue attribute_id = 2;
	map<int64, double> prices = 3;
	Currency currency = 4;
	google.protobuf.Timestamp start_time = 5;
	google.protobuf.Timestamp end_time = 6;
}

message CreatePriceResponse {
	google.protobuf.StringValue price_id = 1;
}

message DescribePricesRequest {
	google.protobuf.StringValue price_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp start_time = 5;
	google.protobuf.Timestamp end_time = 6;
	google.protobuf.StringValue sort_key = 7;
	google.protobuf.BoolValue reverse = 8;
	uint32 offset = 9;
	uint32 limit = 10;
}

message DescribePricesResponse {
	uint32 total_count = 1;
	repeated Price price_set = 2;
}

message ModifyPriceRequest {
    google.protobuf.StringValue price_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp start_time = 5;
	google.protobuf.Timestamp end_time = 6;
}

message ModifyPriceResponse {
	google.protobuf.StringValue price_id = 1;
}

message DeletePricesRequest {
	google.protobuf.StringValue sku_id = 1;
	repeated string price_ids = 2;
}

message DeletePricesResponse {
	repeated string price_ids = 1;
}

message Account {
	google.protobuf.StringValue user_id = 1;
	google.protobuf.StringValue user_type = 2;
	google.protobuf.DoubleValue balance = 3;
	google.protobuf.StringValue currency = 4;
	map<string, double> income = 5;
	google.protobuf.StringValue status = 6;
	google.protobuf.Timestamp create_time = 7;
	google.protobuf.Timestamp status_time = 8;
	google.protobuf.StringValue description = 9;
}

message CreateAccountRequest {
	google.protobuf.StringValue user_id = 1;
	google.protobuf.StringValue user_type = 2;
	google.protobuf.DoubleValue balance = 3;
	google.protobuf.StringValue currency = 4;
	map<string, double> income = 5;
	google.protobuf.StringValue description = 6;
}

message CreateAccountResponse {
	google.protobuf.StringValue user_id = 1;
}

message DescribeAccountsRequest {
	google.protobuf.StringValue user_id = 1;
	google.protobuf.StringValue user_type = 2;
	google.protobuf.StringValue sort_key = 3;
	google.protobuf.BoolValue reverse = 4;
	uint32 offset = 5;
	uint32 limit = 6;
}

message DescribeAccountsResponse {
	uint32 total_count = 1;
	repeated Account account_set = 2;
}

message ModifyAccountRequest {
	google.protobuf.StringValue user_id = 1;
	google.protobuf.StringValue user_type = 2;
	google.protobuf.DoubleValue balance = 3;
	google.protobuf.StringValue currency = 4;
	map<string, double> income = 5;
	google.protobuf.StringValue description = 6;
}

message ModifyAccountResponse {
	google.protobuf.StringValue user_id = 1;
}

message DeleteAccountsRequest {
	repeated string user_ids = 1;
}

message DeleteAccountsResponse {
	repeated string user_ids = 1;
}

message LeasingContract {
	google.protobuf.StringValue contract_id = 1;
	google.protobuf.StringValue leasing_id = 2;
	google.protobuf.StringValue resource_id = 3;
	google.protobuf.StringValue sku_id = 4;
	google.protobuf.StringValue user_id = 5;
	map<string, double> metering_values = 6;
	google.protobuf.StringValue fee_info = 7;
	google.protobuf.DoubleValue fee = 8;
	google.protobuf.DoubleValue due_fee = 9;
	google.protobuf.DoubleValue other_contract_fee = 10;
	google.protobuf.DoubleValue coupon_fee = 11;
	google.protobuf.DoubleValue real_fee = 12;
	google.protobuf.StringValue currency = 13;
	google.protobuf.StringValue status = 14;
	google.protobuf.Timestamp start_time = 15;
	google.protobuf.Timestamp create_time = 16;
	google.protobuf.Timestamp status_time = 17;
}

message DescribeLeasingContractsRequest {
	google.protobuf.StringValue contract_id = 1;
	google.protobuf.StringValue leasing_id = 2;
	google.protobuf.StringValue resource_id = 3;
	google.protobuf.StringValue sku_id = 4;
	google.protobuf.StringValue user_id = 5;
	google.protobuf.StringValue status = 6;
	google.protobuf.StringValue sort_key = 7;
	google.protobuf.BoolValue reverse = 8;
	uint32 offset = 9;
	uint32 limit = 10;
}

message DescribeLeasingContractsResponse {
	uint32 total_count = 1;
	repeated LeasingContract leasing_contract_set = 2;
}

message LeasedContract {
	google.protobuf.StringValue contract_id = 1;
	google.protobuf.StringValue leasing_id = 2;
	google.protobuf.StringValue resource_id = 3;
	google.protobuf.StringValue sku_id = 4;
	google.protobuf.StringValue user_id = 5;
	map<string, double> metering_values = 6;
	google.protobuf.StringValue fee_info = 7;
	google.protobuf.DoubleValue fee = 8;
	google.protobuf.DoubleValue due_fee = 9;
	google.protobuf.DoubleValue other_contract_fee = 10;
	google.protobuf.DoubleValue coupon_fee = 11;
	google.protobuf.DoubleValue real_fee = 12;
	google.protobuf.StringValue currency = 13;
	google.protobuf.Timestamp start_time = 14;
	google.protobuf.Timestamp end_time = 15;
	google.protobuf.Timestamp create_time = 16;
}

message DescribeLeasedContractsRequest {
	google.protobuf.StringValue contract_id = 1;
	google.protobuf.StringValue leasing_id = 2;
	google.protobuf.StringValue resource_id = 3;
	google.protobuf.StringValue sku_id = 4;
	google.protobuf.StringValue user_id = 5;
	google.protobuf.StringValue status = 6;
	google.protobuf.StringValue sort_key = 7;
	google.protobuf.BoolValue reverse = 8;
	uint32 offset = 9;
	uint32 limit = 10;
}

message DescribeLeasedContractsResponse {
	uint32 total_count = 1;
	repeated LeasedContract leased_contract_set = 2;
}

message Recharge {
	google.protobuf.StringValue recharge_id = 1;
	google.protobuf.StringValue user_id = 2;
	google.protobuf.DoubleValue balance = 3;
	google.protobuf.StringValue currency = 4;
	google.protobuf.StringValue status = 5;
	google.protobuf.Timestamp create_time = 6;
	google.protobuf.StringValue description = 7;
}

message CreateRechargeRequest {
	google.protobuf.StringValue user_id = 1;
	google.protobuf.DoubleValue balance = 2;
	google.protobuf.StringValue currency = 3;
	google.protobuf.StringValue description = 4;
}

message CreateRechargeResponse {
	google.protobuf.StringValue recharge_id = 1;
}

message DescribeRechargesRequest {
	google.protobuf.StringValue recharge_id = 1;
	google.protobuf.StringValue user_id = 2;
	uint32 offset = 3;
	uint32 limit = 4;
}

message DescribeRechargesResponse {
	uint32 total_count = 1;
	repeated Recharge recharge_set = 2;
}

message Charge {
	google.protobuf.StringValue charge_id = 1;
	google.protobuf.StringValue contract_id = 2;
	google.protobuf.StringValue user_id = 3;
	google.protobuf.DoubleValue fee = 4;
	google.protobuf.StringValue currency = 5;
	google.protobuf.StringValue status = 6;
	google.protobuf.Timestamp create_time = 7;
	google.protobuf.Timestamp status_time = 8;
}

message DescribeChargesRequest {
	google.protobuf.StringValue charge_id = 1;
	google.protobuf.StringValue contract_id = 2;
	google.protobuf.StringValue user_id = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeChargesResponse {
	uint32 total_count = 1;
	repeated Charge charge_set = 2;
}

message Refund {
	google.protobuf.StringValue Refund_id = 1;
	google.protobuf.StringValue contract_id = 2;
	google.protobuf.StringValue user_id = 3;
	google.protobuf.DoubleValue fee = 4;
	google.protobuf.StringValue currency = 5;
	google.protobuf.StringValue status = 6;
	google.protobuf.Timestamp create_time = 7;
}

message DescribeRefundsRequest {
	google.protobuf.StringValue refund_id = 1;
	google.protobuf.StringValue contract_id = 2;
	google.protobuf.StringValue user_id = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeRefundsResponse {
	uint32 total_count = 1;
	repeated Refund refund_set = 2;
}

message Income {
	google.protobuf.StringValue income_id = 1;
	google.protobuf.StringValue contract_id = 2;
	google.protobuf.StringValue owner_id = 3;
	google.protobuf.DoubleValue balance = 4;
	google.protobuf.StringValue currency = 5;
	google.protobuf.Timestamp create_time = 6;
}

message DescribeIncomesRequest {
	google.protobuf.StringValue income_id = 1;
	google.protobuf.StringValue contract_id = 2;
	google.protobuf.StringValue owner_id = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeIncomesResponse {
	uint32 total_count = 1;
	repeated Income income_set = 2;
}

message Withdraw {
	google.protobuf.StringValue withdraw_id = 1;
	google.protobuf.StringValue user_id = 2;
	google.protobuf.DoubleValue balance = 3;
	google.protobuf.Timestamp create_time = 4;
	google.protobuf.StringValue status = 5;
	google.protobuf.StringValue description = 6;
}

message CreateWithdrawRequest {
	google.protobuf.StringValue user_id = 1;
	google.protobuf.DoubleValue balance = 2;
	google.protobuf.StringValue description = 3;
}

message CreateWithdrawResponse {
	google.protobuf.StringValue withdraw_id = 1;
}

message DescribeWithdrawsRequest {
	google.protobuf.StringValue withdraw_id = 1;
	google.protobuf.StringValue user_id = 2;
	google.protobuf.StringValue status = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeWithdrawsResponse {
	uint32 total_count = 1;
	repeated Withdraw withdraw_set = 2;
}

service BillingManager {
	rpc CreatePrice (CreatePriceRequest) returns (CreatePriceResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
            summary: "create price of the sku with metering_attribute"
        };
		option (google.api.http) = {
            post: "/v1/billing/price"
            body: "*"
        };
	}

	rpc DescribePrices (DescribePricesRequest) returns (DescribePricesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe prices"
		};
		option (google.api.http) = {
			get: "/v1/billing/prices"
		};
	}

	rpc ModifyPrice (ModifyPriceRequest) returns (ModifyPriceResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify price"
		};
		option (google.api.http) = {
			put: "/v1/billing/price"
			body: "*"
		};
	}

	rpc DeletePrices (DeletePricesRequest) returns (DeletePricesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete prices"
		};
		option (google.api.http) = {
			delete: "/v1/billing/prices"
			body: "*"
		};
	}

	rpc CreateAccount (CreateAccountRequest) returns (CreateAccountResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "create account"
		};
		option (google.api.http) = {
			post: "/v1/billing/account"
			body: "*"
		};
	}

	rpc DescribeAccounts (DescribeAccountsRequest) returns (DescribeAccountsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe accounts"
		};
		option (google.api.http) = {
			get: "/v1/billing/accounts"
		};
	}

	rpc ModifyAccount (ModifyAccountRequest) returns (ModifyAccountResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify  account"
		};
		option (google.api.http) = {
			put: "/v1/billing/account"
			body: "*"
		};
	}

	rpc DeleteAccounts (DeleteAccountsRequest) returns (DeleteAccountsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete accounts"
		};
		option (google.api.http) = {
			delete: "/v1/billing/accounts"
			body: "*"
		};
	}

	rpc DescribeLeasingContracts (DescribeLeasingContractsRequest) returns (DescribeLeasingContractsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe leasing_contract"
		};
		option (google.api.http) = {
			get: "/v1/billing/leasing/contracts"
		};
	}

	rpc DescribeLeasedContracts (DescribeLeasedContractsRequest) returns (DescribeLeasedContractsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe leased_contract"
		};
		option (google.api.http) = {
			get: "/v1/billing/leased/contracts"
		};
	}

	rpc CreateRecharge (CreateRechargeRequest) returns (CreateRechargeResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "recharge for user"
		};
		option (google.api.http) = {
			post: "/v1/billing/recharge"
			body: "*"
		};
	}

	rpc DescribeRecharges (DescribeRechargesRequest) returns (DescribeRechargesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe recharges"
		};
		option (google.api.http) = {
			get: "/v1/billing/recharges"
		};
	}

	rpc DescribeCharges (DescribeChargesRequest) returns (DescribeChargesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe charges"
		};
		option (google.api.http) = {
			get: "/v1/billing/charges"
		};
	}

	rpc DescribeRefunds (DescribeRefundsRequest) returns (DescribeRefundsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe refunds"
		};
		option (google.api.http) = {
			get: "/v1/billing/refunds"
		};
	}

	rpc DescribeIncomes (DescribeIncomesRequest) returns (DescribeIncomesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe incomes"
		};
		option (google.api.http) = {
			get: "/v1/billing/incomes"
		};
	}

	rpc CreateWithdraw (CreateWithdrawRequest) returns (CreateWithdrawResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "create withdraw"
		};
		option (google.api.http) = {
			post: "/v1/billing/withdraw"
		};
	}

	rpc DescribeWithdraws (DescribeWithdrawsRequest) returns (DescribeWithdrawsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe withdraws"
		};
		option (google.api.http) = {
			get: "/v1/billing/withdraws"
		};
	}
}



//////////////////////////////////////////////////////////////////////////////////////
////////////////////////// Billing Backend APIs //////////////////////////////////////
//////////////////////////        Start         //////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////

message Context {
	//context.Context
}

message Metering {
    google.protobuf.StringValue leasing_id = 1;
    google.protobuf.StringValue resource_id = 2;
    google.protobuf.StringValue sku_id = 3;
    google.protobuf.StringValue user_id = 4;
    google.protobuf.StringValue action_id = 5;
    map<string, double> metering_values = 6;
	google.protobuf.Timestamp update_time = 7;
}

message BillingRequest {
	Context context = 1;
	Metering metering = 2;
}

message NIL {} //there is no response

message CreateLeasingContractRequest {
	google.protobuf.StringValue leasing_id = 1;
	google.protobuf.StringValue resource_id = 2;
	google.protobuf.StringValue sku_id = 3;
	google.protobuf.StringValue user_id = 4;
	map<string, double> metering_values = 5;
	google.protobuf.Timestamp start_time = 6;
}

message CreateLeasingContractResponse {
	LeasingContract leasing_contract = 1;
}

message CalculateRequest {
	Context ctx = 1;
	Metering metering = 2;
	LeasingContract leaing_contract = 3;
}

message LeasingContractOperationRequest {
	Context ctx = 1;
	LeasingContract leaing_contract = 2;
}


service BillingBackendManager {
	rpc Billing (BillingRequest) returns (NIL) {
		// CreateLeasingContract() or get LeasingContract

		// Calculate()

		// DuductCoupon() if due_fee > 0
		// RefundCoupon() if due_fee < 0

		//CreateCharge() if due_fee > 0
		//CreateRefund() if due_fee < 0

	}

	rpc CreateLeasingContract (CreateLeasingContractRequest) returns (CreateLeasingContractResponse) {}

	rpc Calculate (CalculateRequest) returns (LeasingContract) {}

	rpc DeductCoupon (LeasingContractOperationRequest) returns (LeasingContract) {}

	rpc RefundCoupon (LeasingContractOperationRequest) returns (LeasingContract) {}

	rpc CreateCharge (LeasingContractOperationRequest) returns (LeasingContract) {}

	rpc CreateRefund (LeasingContractOperationRequest) returns (LeasingContract) {}

}

//////////////////////////////////////////////////////////////////////////////////////
////////////////////////// 			End         //////////////////////////////////////
////////////////////////// Billing Backend APIs //////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////


//*************************************************************************
//*************************** Promotion ***********************************
//*************************************************************************
//combination_price
message CombinationPrice {
    google.protobuf.StringValue combination_price_id = 1;
    google.protobuf.StringValue combination_sku_id = 2;
    google.protobuf.StringValue attribute_id = 3;
	map<int64, double> prices = 4;
	Currency currency = 5;
	google.protobuf.StringValue status = 6;
	google.protobuf.Timestamp create_time = 7;
	google.protobuf.Timestamp status_time = 8;
}

message CreateCombinationPriceRequest {
	google.protobuf.StringValue combination_sku_id = 1;
	google.protobuf.StringValue attribute_id = 2;
	map<int64, double> prices = 3;
	Currency currency = 4;
}

message CreateCombinationPriceResponse {
	google.protobuf.StringValue combination_price_id = 1;
}

message DescribeCombinationPricesRequest {
	google.protobuf.StringValue combination_price_id = 1;
	google.protobuf.StringValue combination_sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeCombinationPricesResponse {
	uint32 total_count = 1;
	repeated CombinationPrice combination_price_set = 2;
}

message ModifyCombinationPriceRequest {
	google.protobuf.StringValue combination_price_id = 1;
	google.protobuf.StringValue combination_sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
	map<int64, double> prices = 4;
	Currency currency = 5;
}

message ModifyCombinationPriceResponse {
	google.protobuf.StringValue combination_price_id = 1;
}

message DeleteCombinationPricesRequest {
	google.protobuf.StringValue combination_sku_id = 1;
	repeated string combination_price_ids = 2;
}

message DeleteCombinationPricesResponse {
	repeated string combination_price_ids = 1;
}

//probation
message Probation {
	google.protobuf.StringValue probation_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.Timestamp start_time = 5; //start time for this probation, default now
	google.protobuf.Timestamp end_time = 6; //overdue time for this probation, default null(forever)
	google.protobuf.Timestamp create_time = 7;
	google.protobuf.Timestamp status_time = 8;
}

message CreateProbationRequest {
	google.protobuf.StringValue sku_id = 1;
	google.protobuf.StringValue attribute_id = 2;
	google.protobuf.Timestamp start_time = 3;
	google.protobuf.Timestamp end_time = 4;
}

message CreateProbationResponse {
	google.protobuf.StringValue probation_id = 1;
}

message DescribeProbationsRequest {
	google.protobuf.StringValue probation_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue status = 3;
	google.protobuf.StringValue sort_key = 4;
	google.protobuf.BoolValue reverse = 5;
	uint32 offset = 6;
	uint32 limit = 7;
}

message DescribeProbationsResponse {
	uint32 total_count = 1;
	repeated Probation probation_set = 2;
}

message ModifyProbationRequest {
	google.protobuf.StringValue probation_id = 1;
	google.protobuf.StringValue sku_id = 2;
	google.protobuf.StringValue attribute_id = 3;
	google.protobuf.Timestamp start_time = 4;
	google.protobuf.Timestamp end_time = 5;
}

message ModifyProbationResponse {
	google.protobuf.StringValue probation_id = 1;
}

message DeleteProbationsRequest {
	repeated string probation_ids = 1;
}

message DeleteProbationsResponse {
	repeated string probation_ids = 1;
}

//Discount
message Discount {
    google.protobuf.StringValue discount_id = 1;
    google.protobuf.StringValue name = 2;
	repeated string limit_ids = 3; //the ids of limit spu/sku/price, distinguish them by prefix.
    google.protobuf.DoubleValue discount_value = 4; //cut down value
    google.protobuf.DoubleValue discount_percent = 5; //cut down percent
	google.protobuf.StringValue status = 6;
	google.protobuf.StringValue owner = 7;
    google.protobuf.Timestamp start_time = 8;
    google.protobuf.Timestamp end_time = 9;
    google.protobuf.Timestamp create_time = 10;
    google.protobuf.Timestamp status_time = 11;
    google.protobuf.StringValue description = 12;

}

message CreateDiscountRequest {
	google.protobuf.StringValue name = 1;
	repeated string limit_ids = 2;
	google.protobuf.DoubleValue discount_value = 3;
	google.protobuf.DoubleValue discount_percent = 4;
	google.protobuf.Timestamp start_time = 5;
	google.protobuf.Timestamp end_time = 6;
	google.protobuf.StringValue description = 7;
}

message CreateDiscountResponse {
	google.protobuf.StringValue discount_id = 1;
}

message DescribeDiscountsRequest {
	google.protobuf.StringValue discount_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue owner = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeDiscountsResponse {
	uint32 total_count = 1;
	repeated Discount discount_set = 2;
}

message ModifyDiscountRequest {
	google.protobuf.StringValue discount_id = 1;
	google.protobuf.StringValue name = 2;
	repeated string limit_ids = 3;
	google.protobuf.DoubleValue discount_value = 4;
	google.protobuf.DoubleValue discount_percent = 5;
	google.protobuf.Timestamp start_time = 6;
	google.protobuf.Timestamp end_time = 7;
	google.protobuf.StringValue description = 8;
}

message ModifyDiscountResponse {
	google.protobuf.StringValue discount_id = 1;
}

message DeleteDiscountsRequest {
	repeated string discount_ids = 1;
}

message DeleteDiscountsResponse {
	repeated string discount_ids = 1;
}

message Coupon {
    google.protobuf.StringValue coupon_id = 1;
    google.protobuf.StringValue name = 2;
    google.protobuf.StringValue owner = 3;
	repeated string limit_ids = 4; //the ids of limit spu/sku/price, distinguish them by prefix.
    google.protobuf.DoubleValue balance = 5;
    google.protobuf.UInt32Value count = 6;
    google.protobuf.UInt32Value remain = 7; //remain num of coupon
    google.protobuf.UInt32Value limit_num_per = 8;
	google.protobuf.StringValue status = 9;
	google.protobuf.Timestamp start_time = 10;
	google.protobuf.Timestamp end_time = 11;
	google.protobuf.Timestamp create_time = 12;
	google.protobuf.Timestamp status_time = 13;
    google.protobuf.StringValue description = 14;
}

message CreateCouponRequest {
	google.protobuf.StringValue name = 1;
	repeated string limit_ids = 2;
	google.protobuf.DoubleValue balance = 3;
	google.protobuf.UInt32Value count = 4;
	google.protobuf.UInt32Value limit_num_per = 5;
	google.protobuf.Timestamp start_time = 6;
	google.protobuf.Timestamp end_time = 7;
	google.protobuf.StringValue description = 8;
}

message CreateCouponResponse {
	google.protobuf.StringValue coupon_id = 1;
}

message DescribeCouponsRequest {
	google.protobuf.StringValue coupon_id = 1;
	google.protobuf.StringValue name = 2;
	google.protobuf.StringValue owner = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeCouponsResponse {
	uint32 total_count = 1;
	repeated Coupon coupon_set = 2;
}

message ModifyCouponRequest {
	google.protobuf.StringValue coupon_id = 1;
	google.protobuf.StringValue name = 2;
	repeated string limit_ids = 3;
	google.protobuf.DoubleValue balance = 4;
	google.protobuf.UInt32Value count = 5;
	google.protobuf.UInt32Value limit_num_per = 6;
	google.protobuf.Timestamp start_time = 7;
	google.protobuf.Timestamp end_time = 8;
	google.protobuf.StringValue description = 9;
}

message ModifyCouponResponse {
	google.protobuf.StringValue coupon_id = 1;
}

message DeleteCouponsRequest {
	repeated string coupon_ids = 1;
}

message DeleteCouponsResponse {
	repeated string coupon_ids = 1;
}

message CouponReceived {
    google.protobuf.StringValue coupon_received_id = 1;
    google.protobuf.StringValue coupon_id = 2;
    google.protobuf.StringValue user_id = 3;
	google.protobuf.DoubleValue remain = 4; //remain balance of coupon
	google.protobuf.StringValue status = 5;
	google.protobuf.Timestamp create_time = 6;
	google.protobuf.Timestamp status_time = 7;
}

message CreateCouponReceivedRequest {
	google.protobuf.StringValue coupon_id = 1;
}

message CreateCouponReceivedResponse {
	google.protobuf.StringValue coupon_received_id = 1;
}

message DescribeCouponReceivedsRequest {
	google.protobuf.StringValue coupon_received_id = 1;
	google.protobuf.StringValue coupon_id = 2;
	google.protobuf.StringValue user_id = 3;
	google.protobuf.StringValue status = 4;
	google.protobuf.StringValue sort_key = 5;
	google.protobuf.BoolValue reverse = 6;
	uint32 offset = 7;
	uint32 limit = 8;
}

message DescribeCouponReceivedsResponse {
	uint32 total_count = 1;
	repeated CouponReceived coupon_received_set = 2;
}

message DeleteCouponReceivedsRequest {
	repeated string coupon_received_ids = 1;
}

message DeleteCouponReceivedsResponse {
	repeated string coupon_received_ids = 1;
}

service PromotionManager {
	rpc CreateCombinationPrice (CreateCombinationPriceRequest) returns (CreateCombinationPriceResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "create combination price of combination sku"
		};
		option (google.api.http) = {
			post: "/v1/billing/combination/price"
			body: "*"
		};
	}

	rpc DescribeCombinationPrices (DescribeCombinationPricesRequest) returns (DescribeCombinationPricesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe combination prices"
		};
		option (google.api.http) = {
			get: "/v1/billing/combination/prices"
		};
	}

	rpc ModifyCombinationPrice (ModifyCombinationPriceRequest) returns (ModifyCombinationPriceResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify  combination price"
		};
		option (google.api.http) = {
			put: "/v1/billing/combination/price"
			body: "*"
		};
	}

	rpc DeleteCombinationPrices (DeleteCombinationPricesRequest) returns (DeleteCombinationPricesResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete combination prices"
		};
		option (google.api.http) = {
			delete: "/v1/billing/combination/prices"
			body: "*"
		};
	}

	rpc CreateProbation (CreateProbationRequest) returns (CreateProbationResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "create probation of sku"
		};
		option (google.api.http) = {
			post: "/v1/billing/probation"
			body: "*"
		};
	}

	rpc DescribeProbations (DescribeProbationsRequest) returns (DescribeProbationsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe probations"
		};
		option (google.api.http) = {
			get: "/v1/billing/probations"
		};
	}

	rpc ModifyProbation (ModifyProbationRequest) returns (ModifyProbationResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify probation"
		};
		option (google.api.http) = {
			put: "/v1/billing/probation"
			body: "*"
		};
	}

	rpc DeleteProbations (DeleteProbationsRequest) returns (DeleteProbationsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete probations"
		};
		option (google.api.http) = {
			delete: "/v1/billing/probations"
			body: "*"
		};
	}

	rpc CreateDiscount (CreateDiscountRequest) returns (CreateDiscountResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "create discount"
		};
		option (google.api.http) = {
			post: "/v1/billing/discount"
			body: "*"
		};
	}

	rpc DescribeDiscounts (DescribeDiscountsRequest) returns (DescribeDiscountsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe discounts"
		};
		option (google.api.http) = {
			get: "/v1/billing/discounts"
		};
	}

	rpc ModifyDiscount (ModifyDiscountRequest) returns (ModifyDiscountResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify discount"
		};
		option (google.api.http) = {
			put: "/v1/billing/discount"
			body: "*"
		};
	}

	rpc DeleteDiscounts (DeleteDiscountsRequest) returns (DeleteDiscountsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete discounts"
		};
		option (google.api.http) = {
			delete: "/v1/billing/discounts"
			body: "*"
		};
	}

	rpc CreateCoupon (CreateCouponRequest) returns (CreateCouponResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "create coupon"
		};
		option (google.api.http) = {
			post: "/v1/billing/coupon"
			body: "*"
		};
	}

	rpc DescribeCoupons (DescribeCouponsRequest) returns (DescribeCouponsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe coupons"
		};
		option (google.api.http) = {
			get: "/v1/billing/coupons"
		};
	}

	rpc ModifyCoupon (ModifyCouponRequest) returns (ModifyCouponResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "modify coupon"
		};
		option (google.api.http) = {
			put: "/v1/billing/coupon"
			body: "*"
		};
	}

	rpc DeleteCoupons (DeleteCouponsRequest) returns (DeleteCouponsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete coupons"
		};
		option (google.api.http) = {
			delete: "/v1/billing/coupons"
			body: "*"
		};
	}

	rpc CreateCouponReceived (CreateCouponReceivedRequest) returns (CreateCouponReceivedResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "receive coupon"
		};
		option (google.api.http) = {
			post: "/v1/billing/coupon/received"
			body: "*"
		};
	}

	rpc DescribeCouponReceiveds (DescribeCouponReceivedsRequest) returns (DescribeCouponReceivedsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "describe coupon_receiveds"
		};
		option (google.api.http) = {
			get: "/v1/billing/coupon/receiveds"
		};
	}

	rpc DeleteCouponReceiveds (DeleteCouponReceivedsRequest) returns (DeleteCouponReceivedsResponse) {
		option (grpc.gateway.protoc_gen_swagger.options.openapiv2_operation) = {
			summary: "delete coupon_receiveds"
		};
		option (google.api.http) = {
			delete: "/v1/billing/coupon/receiveds"
			body: "*"
		};
	}
}
